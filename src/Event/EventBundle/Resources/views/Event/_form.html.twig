{% form_theme form 'EventEventBundle::form_theme.html.twig' %}

{{ form_start(form, {'method': 'POST', 'action': url('event_component_call_for_paper')}) }}
{{ form_widget(form) }}

    {{ form_rest(form) }}

            <div class="alert alert-error captcha-error-form" style="display:none;"></div>
            <div class="raw">
                 {#simple captcha#}
                <div class="col-lg-3">
                    <img class="img-circle" id="call-cap" data-src="holder.js/140x40/text:{{ captcha.first ~ ' + ' ~ captcha.last ~ ' =' }}" width="140" />
                </div>
                <div class="col-lg-2">
                    <input type="text" name="calc" class="form-control captcha-calc-form" required="required" />
                </div>
            </div>

<button type="button" class="btn btn-default" data-dismiss="modal">{{ 'Close'|trans }}</button>
<button type="submit" class="btn btn-primary send-request">{{ 'Send'|trans }}</button>
{{ form_end(form) }}

<script type="text/javascript">
    $(function(){
        $('.send-request').on('click', function(e) {
            e.preventDefault();
            var first = '{{ captcha.first }}',
                last = '{{ captcha.last }}',
                result = $('.captcha-calc-form').val();

            if (!checkCaptcha(first, last, result, 'captcha-error-form')) {
                return false;
            }

            $(this).html("{{ 'Sending'|trans }}" + "...").prop('disabled', 'disabled');

            $.post(
                $(this.form).attr('action'),
                $(this.form).serializeArray(),
                function(data){
                    if (data == 'Success') {
                        $('#callForPaperForm').html("{{ 'Thank you for request, we\'ll answer back asap.'|trans }}");
                    } else {
                        $('#callForPaperForm').html(data);
                        var myImage = document.getElementById('call-cap');

                        Holder.run({
                            images: myImage
                        });
                    }

                    $(this).html("{{ 'Send'|trans }}").removeProp('disabled');
                }
            );
        });
    });
</script>
